!function t(e,r,i){function s(n,o){if(!r[n]){if(!e[n]){var h="function"==typeof require&&require;if(!o&&h)return h(n,!0);if(a)return a(n,!0);var u=new Error("Cannot find module '"+n+"'");throw u.code="MODULE_NOT_FOUND",u}var l=r[n]={exports:{}};e[n][0].call(l.exports,function(t){var r=e[n][1][t];return s(r||t)},l,l.exports,t,e,r,i)}return r[n].exports}for(var a="function"==typeof require&&require,n=0;n<i.length;n++)s(i[n]);return s}({1:[function(t,e,r){"use strict";var i=i||{},s=t("./vecmath.js");i.Camera=function(){this.position={x:5,y:5,z:5},this.target={x:0,y:0,z:0},this.up={x:0,y:1,z:0},this.mat=s.getInit(),this.proj_matrix=s.orthogonal(5,1,1,100),this.light_proj_matrix=s.orthogonal(512,1,-256,256),this.light_mat=s.getInit(),this.light={x:1,y:1,z:1},this.perspective=!1,this.fov=1},i.Camera.prototype.constructor=i.Camera,i.Camera.prototype.SetPosition=function(t,e,r){this.x=t,this.y=e,this.z=r},i.Camera.prototype.SetTarget=function(t,e,r){this.tx=t,this.ty=e,this.tz=r},i.Camera.prototype.matCalctulate=function(){var t=s.vNormalise(s.minus3(this.target,this.position)),e=s.vNormalise(this.up),r=s.vNormalise(s.v3CrossProduct(t,e));e=s.v3CrossProduct(r,t),this.mat[0]=r.x,this.mat[4]=r.y,this.mat[8]=r.z,this.mat[1]=e.x,this.mat[5]=e.y,this.mat[9]=e.z,this.mat[2]=-t.x,this.mat[6]=-t.y,this.mat[10]=-t.z,this.mat[12]=-s.vDotProduct(r,this.position),this.mat[13]=-s.vDotProduct(e,this.position),this.mat[14]=s.vDotProduct(t,this.position);var i={x:this.light.x+this.target.x,y:this.light.y+this.target.y,z:this.light.z+this.target.z};return t=s.vNormalise(s.minus3(this.target,i)),e=s.vNormalise({x:0,y:1,z:0}),r=s.vNormalise(s.v3CrossProduct(t,e)),e=s.v3CrossProduct(r,t),this.light_mat[0]=r.x,this.light_mat[4]=r.y,this.light_mat[8]=r.z,this.light_mat[1]=e.x,this.light_mat[5]=e.y,this.light_mat[9]=e.z,this.light_mat[2]=-t.x,this.light_mat[6]=-t.y,this.light_mat[10]=-t.z,this.light_mat[12]=-s.vDotProduct(r,i),this.light_mat[13]=-s.vDotProduct(e,i),this.light_mat[14]=s.vDotProduct(t,i),this.mat},i.Camera.prototype.getMat=function(){return this.mat},i.Camera.prototype.lookAt=function(t,e,r,i,s,a,n,o,h){return this.position={x:t,y:e,z:r},this.target={x:i,y:s,z:a},this.up={x:n,y:o,z:h},this.matCalctulate()},i.Camera.prototype.getLight=function(){return this.light_mat},i.Camera.prototype.setLightDirection=function(t,e,r){this.light={x:t,y:e,z:r}},i.Camera.prototype.getLightProj=function(){return this.light_proj_matrix},i.Camera.prototype.setLightProj=function(t,e,r,i){this.light_proj_matrix=s.orthogonal(t,e,r,i)},i.Camera.prototype.calcProjection=function(){return this.perspective?this.proj_matrix=s.perspective(this.fov,this.width/this.height,this.near,this.far):this.proj_matrix=s.orthogonal(this.fov,this.width/this.height,this.near,this.far),this.proj_matrix},i.Camera.prototype.setProjection=function(t,e,r,i,s,a){return this.perspective=a,this.fov=t,this.width=e,this.height=r,this.near=i,this.far=s,this.calcProjection(),this.proj_matrix},i.Camera.prototype.getProj=function(){return this.proj_matrix},e&&(e.exports=i)},{"./vecmath.js":8}],2:[function(t,e,r){"use strict";var i=i||{},s=t("./vecmath.js");i.Lights=function(){this.lights=s.isGLfloat?new Float32Array(35):new Array(35),this.last=0},i.Lights.prototype.Draw=function(t,e){e.Flights&&t.uniform1fv(e.Flights,this.lights)},i.Lights.prototype.clear=function(){this.last=0;for(var t=0;t<35;t++)this.lights[t]=0},i.Lights.prototype.addLight=function(t,e,r){var i=7*(this.last%6);return this.lights[i]=t[0],this.lights[i+1]=t[1],this.lights[i+2]=t[2],this.lights[i+3]=e.x,this.lights[i+4]=e.y,this.lights[i+5]=e.z,this.lights[i+6]=r,this.last+=1,e},e&&(e.exports=i)},{"./vecmath.js":8}],3:[function(t,e,r){"use strict";var i=i||{};i.Loader=function(t){this.urls={},this.toGet=[],this.loaded=0,this.engine=t},i.Loader.prototype.constructor=i.Loader,i.Loader.prototype.add=function(t,e,r){this.toGet.push(t),this.urls[t]={url:e,data:"",model:r}},i.Loader.prototype.loadModels=function(t){for(var e in t)t.hasOwnProperty(e)&&t[e].model&&this.engine.loadModel(e,t[e].data)},i.Loader.prototype.load=function(){function t(){if(e.toGet.length<=0)return e.loadModels(r),void e.callback(r);var i=r[e.toGet.pop()],s=new XMLHttpRequest;s.open("get",i.url,!0),s.onload=function(){200==s.status?i.data=s.response:console.error("not loaded: "+i.url),e.loaded+=1,t()},s.send()}var e=this,r=this.urls;t()},i.Loader.prototype.onLoad=function(t){this.callback=t},i.Loader.prototype.onError=function(){},e&&(e.exports=i)},{}],4:[function(t,e,r){"use strict";var i=i||{};i.gameResize=function(){},i.Camera=t("./camera.js").Camera,i.Lights=t("./lights.js").Lights,i.Mesh=t("./mesh.js").Mesh,i.Rendable=t("./rendable.js").Rendable,i.ARendable=t("./rendable.js").ARendable,i.Shader=t("./shader.js").Shader,i.Loader=t("./loader.js").Loader;var s=t("./vecmath.js");i.Engine=function(){function t(){e.canvas&&(e.preview[0]=e.canvas.viewportWidth=canvas.width,e.preview[1]=e.canvas.viewportHeight=canvas.height,i.gameResize())}this.canvas=null,this.preview=[512,512],this.curShader="defolt",this.shaders={defolt:{}},this.shaderProgram=null,this.models={},this.textures={},this.renables=[],this.efects=[],this.camera=new i.Camera,this.lights=new i.Lights,this.tReady=0,this.onload=null,this.keysDown={},this.keysUp={};var e=this;t(),document.addEventListener("keydown",function(t){e.keyPressed(t)}),document.addEventListener("keyup",function(t){e.keyReleased(t)}),window.addEventListener("resize",t,!0)},i.Engine.prototype.constructor=i.Engine,i.Engine.prototype.onLoaded=function(t){this.onload=t,this.onloadToDo=!0},i.Engine.prototype.onKey=function(t,e,r){this.keysDown[t]=e,this.keysUp[t]=r},i.Engine.prototype.keyPressed=function(t){var e=t.keyCode;this.keysDown[e]&&this.keysDown[e](),t.preventDefault()},i.Engine.prototype.keyReleased=function(t){var e=t.keyCode;this.keysUp[e]&&(this.keysUp[e](),t.preventDefault())},i.Engine.prototype.selectCanvas=function(t){if(this.canvas)throw"WebGL allready initialised";try{this.canvas=t.getContext("experimental-webgl",{antialias:!0}),this.canvas||(this.canvas=t.getContext("experimental-webgl")),this.canvas||(this.canvas=t.getContext("webgl")),window.dispatchEvent(new Event("resize"))}catch(t){}if(!this.canvas)throw"We could not intitialise WebGL on your browser"},i.Engine.prototype.vertexShader=function(t){if(!t)throw"no vertex shader code";if(!this.canvas)throw"select canvas first";var e,r=this.canvas;if(e=r.createShader(r.VERTEX_SHADER),r.shaderSource(e,t),r.compileShader(e),!r.getShaderParameter(e,r.COMPILE_STATUS))throw"vertex shader compile faild: "+r.getShaderInfoLog(e);return this.shaders[this.curShader].vertex=e,e},i.Engine.prototype.fragmentShader=function(t){if(!t)throw"no vertex shader code";if(!this.canvas)throw"select canvas first";var e,r=this.canvas;if(e=r.createShader(r.FRAGMENT_SHADER),r.shaderSource(e,t),r.compileShader(e),!r.getShaderParameter(e,r.COMPILE_STATUS))throw"fragment shader compile faild: "+r.getShaderInfoLog(e);return this.shaders[this.curShader].fragment=e,e},i.Engine.prototype.selectShader=function(t){this.curShader=t,this.shaders[this.curShader]||(this.shaders[this.curShader]={}),this.shaders[this.curShader].program&&(this.shaderProgram=this.shaders[this.curShader].program,this.shaderProgram.select())},i.Engine.prototype.initShaders=function(){var t=this.canvas;if(!t)throw"canvas not selected";if(!this.shaders[this.curShader])throw"shaders not compiled for selection "+this.curShader;if(!this.shaders[this.curShader].fragment)throw" fragment shader not compiled for selection "+this.curShader;if(!this.shaders[this.curShader].vertex)throw" vertex shader not compiled for selection "+this.curShader;var e=this.shaders[this.curShader].fragment,r=this.shaders[this.curShader].vertex;this.shaderProgram=new i.Shader(t,r,e,["Pmatrix","Vmatrix","Mmatrix","Flights","Lmatrix","PmatrixLight","source_direction","sampler","samplerShadowMap","time","inv_trans"],["position","uv","normal"]),this.shaders[this.curShader].program=this.shaderProgram,t.uniform1i(this.shaderProgram.sampler,0),t.uniform1i(this.shaderProgram.samplerShadowMap,1);var a={x:5,y:7,z:5};a=s.vNormalise(a),i.LIGHTDIR=[a.x,a.y,a.z],this.camera.light=a,this.camera.matCalctulate(),t.uniform3fv(this.shaderProgram.source_direction,i.LIGHTDIR),t.disable(t.DEPTH_TEST),t.enable(t.BLEND),t.clearDepth(1),t.enable(t.CULL_FACE),t.cullFace(t.BACK)},i.Engine.prototype.initShadersPackage=function(t){var e=this.canvas;if(!e)throw"canvas not selected";t.program=new i.Shader(e,this.vertexShader(t.vertex),this.fragmentShader(t.fragment),t.uniform,t.attribute),this.shaders[t.name]=t,this.shaderProgram=t.program,e.uniform1i(this.shaderProgram.sampler,0),e.uniform1i(this.shaderProgram.samplerShadowMap,1);var r={x:5,y:7,z:5};r=s.vNormalise(r),i.LIGHTDIR=[r.x,r.y,r.z],this.camera.light=r,this.camera.matCalctulate(),e.uniform3fv(this.shaderProgram.source_direction,i.LIGHTDIR),e.disable(e.DEPTH_TEST),e.enable(e.BLEND),e.clearDepth(1),e.enable(e.CULL_FACE),e.cullFace(e.BACK)},i.Engine.prototype.loadTexture=function(t,e){var r=this.canvas,i=this,s=r.createTexture();s.image=new Image,s.image.onload=function(t){r.bindTexture(r.TEXTURE_2D,s),r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,!0),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,s.image),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.NEAREST),r.generateMipmap(r.TEXTURE_2D),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.NEAREST_MIPMAP_LINEAR),r.bindTexture(r.TEXTURE_2D,null),r.activeTexture(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,s),i.tReady--},i.tReady++,s.image.src=e,i.textures[t]=s},i.Engine.prototype.loadModel=function(t,e){var r=null;r="string"==typeof e||e instanceof String?JSON.parse(e):e;var s=new i.Mesh(this.canvas);s.SetMesh(r.vertices,r.textcords,r.normals,r.indices),this.models[t]=r,this.models[t].mesh=s;this.canvas},i.framecount=0,i.framelast=0,i.framerate=0,i.bindTexture=0,i.bindTextureCount=0,setInterval(function(){i.framerate=i.framecount-i.framelast,i.framelast=i.framecount},1e3),i.Engine.prototype.render=function(){var t=this;if(this.tReady<1){this.onloadToDo&&(this.onload(),this.onloadToDo=!1),i.framecount+=1;var e=this.canvas,r=this.camera,s=null;if(this.shaders.shadow){if(!this.texture_rtt){s=this.fb=e.createFramebuffer(),e.bindFramebuffer(e.FRAMEBUFFER,s);var a=this.rb=e.createRenderbuffer();e.bindRenderbuffer(e.RENDERBUFFER,a),e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_COMPONENT16,1024,1024),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,a);var n=this.texture_rtt=e.createTexture();e.bindTexture(e.TEXTURE_2D,n),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,1024,1024,0,e.RGBA,e.UNSIGNED_BYTE,null),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,n,0),e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null)}e.bindFramebuffer(e.FRAMEBUFFER,this.fb),this.selectShader("shadow");var o=this.shaderProgram;e.viewport(0,0,1024,1024),e.clearColor(1,0,0,1),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),e.uniformMatrix4fv(o.Pmatrix,!1,r.getLightProj()),e.uniformMatrix4fv(o.Lmatrix,!1,r.getLight());for(var h in this.renables)if(this.renables.hasOwnProperty(h))for(var u=this.renables[h],l=0;l<u.length;l++)u[l].Draw(o);e.bindFramebuffer(e.FRAMEBUFFER,null)}e.clearColor(0,0,0,0),e.viewport(0,0,this.preview[0],this.preview[1]),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),e.enable(e.DEPTH_TEST),e.enable(e.BLEND),e.depthFunc(e.LEQUAL),e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA);for(var h in this.renables)if(this.renables.hasOwnProperty(h)){this.selectShader(h);var c=this.renables[h];(o=this.shaderProgram).time&&e.uniform1f(o.time,i.framecount/10),e.uniformMatrix4fv(o.Pmatrix,!1,r.getProj()),e.uniformMatrix4fv(o.Vmatrix,!1,r.getMat()),e.uniformMatrix4fv(o.PmatrixLight,!1,r.getLightProj()),e.uniformMatrix4fv(o.Lmatrix,!1,r.getLight()),this.texture_rtt&&(e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,this.texture_rtt)),this.lights.Draw(e,o);for(l=0;l<c.length;l++)c[l].Draw(o)}if(this.efects.length>0){this.selectShader("efects"),o=this.shaderProgram,e.uniformMatrix4fv(o.Pmatrix,!1,r.getProj()),e.uniformMatrix4fv(o.Vmatrix,!1,r.getMat()),e.cullFace(e.BACK);for(l=0;l<this.efects.length;l++)this.efects[l].Draw(o)}e.flush()}window.requestAnimationFrame(function(){t.render()})},i.Engine.prototype.getCamera=function(t,e){return this.camera},i.Engine.prototype.getObject=function(t,e,r,s,a){var n=new i.Rendable(this.canvas,this.models[e].mesh,this.textures[r],t,0,a);return s&&this.addRender(n),n},i.Engine.prototype.getAObject=function(t,e,r,s,a){for(var n=[],o=[],h=0;h<e.length;h++)n.push(this.models[e[h]].mesh);for(var u=0;u<r.length;u++)o.push(this.textures[r[u]]);var l=new i.ARendable(this.canvas,n,o,t,0,a);return s&&this.addRender(l),l},i.Engine.prototype.addRender=function(t){var e=t.shaderid;this.renables[e]||(this.renables[e]=[]),this.renables[e].push(t),this.renables[e]=this.renables[e].sort(function(t,e){return t.position.y>e.position.y?1:t.position.y<e.position.y?-1:0})},i.Engine.prototype.getEfect=function(t,e,r,s){var a=new i.Rendable(this.canvas,this.models[e].mesh,this.textures[r],t,0);return s&&this.efects.push(a),a},i.Engine.prototype.getObjectsStatic=function(t,e,r,s,a,n){for(var o={vertices:[],textcords:[],normals:[],indices:[]},h=this.models[r],u=0;u<e.length;u++)o.vertices=o.vertices.concat(h.vertices),o.textcords=o.textcords.concat(h.textcords),o.normals=o.normals.concat(h.normals),o.indices=o.indices.concat(h.indices);for(u=0;u<e.length;u++){for(l=0;l<h.indices.length;l++)o.indices[u*h.indices.length+l]+=u*h.vertices.length/3;for(var l=0;l<h.vertices.length;l++)o.vertices[u*h.vertices.length+l]=l%3==0?parseFloat(o.vertices[u*h.vertices.length+l])+e[u].x:l%3==1?parseFloat(o.vertices[u*h.vertices.length+l])+e[u].y:parseFloat(o.vertices[u*h.vertices.length+l])+e[u].z}var c=new i.Mesh(this.canvas);c.SetMesh(o.vertices,o.textcords,o.normals,o.indices);var f=new i.Rendable(this.canvas,c,this.textures[s],t,0,n);return a&&this.addRender(f),f},i.Engine.prototype.remObject=function(t){for(var e in this.renables)this.renables.hasOwnProperty(e)&&(this.renables[e]=this.renables[e].filter(function(e){return e!=t}));this.efects=this.efects.filter(function(e){return e!=t})},window.OAK=i},{"./camera.js":1,"./lights.js":2,"./loader.js":3,"./mesh.js":5,"./rendable.js":6,"./shader.js":7,"./vecmath.js":8}],5:[function(t,e,r){"use strict";var i=i||{};i.Mesh=function(t){this.gl=t,this.id=Math.random()},i.Mesh.prototype.constructor=i.Mesh,i.lastMesh=0,i.lastShader=0,i.Mesh.prototype.Draw=function(t){var e=this.gl;i.lastMesh==this.id&&i.lastShader==t||(i.lastMesh=this.id,i.lastShader=t,t.position>=0&&(e.bindBuffer(e.ARRAY_BUFFER,this.vertex_buffer),e.vertexAttribPointer(t.position,3,e.FLOAT,!1,0,0),e.enableVertexAttribArray(t.position)),t.uv>=0&&(e.bindBuffer(e.ARRAY_BUFFER,this.texcords_buffer),e.vertexAttribPointer(t.uv,2,e.FLOAT,!1,0,0),e.enableVertexAttribArray(t.uv)),t.normal>=0&&(e.bindBuffer(e.ARRAY_BUFFER,this.normals_buffer),e.vertexAttribPointer(t.normal,3,e.FLOAT,!1,0,0),e.enableVertexAttribArray(t.normal)),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.index_buffer)),e.drawElements(e.TRIANGLES,this.index_buffer.len,e.UNSIGNED_SHORT,0)},i.Mesh.prototype.SetMesh=function(t,e,r,i){var s=this.gl,a=s.createBuffer();s.bindBuffer(s.ARRAY_BUFFER,a),s.bufferData(s.ARRAY_BUFFER,new Float32Array(t),s.STATIC_DRAW),this.vertex_buffer=a;var n=s.createBuffer();s.bindBuffer(s.ARRAY_BUFFER,n),s.bufferData(s.ARRAY_BUFFER,new Float32Array(e),s.STATIC_DRAW),this.texcords_buffer=n;var o=s.createBuffer();s.bindBuffer(s.ARRAY_BUFFER,o),s.bufferData(s.ARRAY_BUFFER,new Float32Array(r),s.STATIC_DRAW),this.normals_buffer=o;var h=s.createBuffer();s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,h),s.bufferData(s.ELEMENT_ARRAY_BUFFER,new Uint16Array(i),s.STATIC_DRAW),this.index_buffer=h,this.index_buffer.len=i.length},i.Mesh.prototype.SetColors=function(t){this.gl},i.Mesh.prototype.SetTextureCords=function(t){var e=this.gl;return this.triangleVertexTextureCoordBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.triangleVertexTextureCoordBuffer),e.bufferData(e.ARRAY_BUFFER,new Float32Array(t),e.STATIC_DRAW),this.triangleVertexTextureCoordBuffer.itemSize=2,this.triangleVertexTextureCoordBuffer.numItems=t.length/2,this.triangleVertexTextureCoordBuffer},e&&(e.exports=i)},{}],6:[function(t,e,r){"use strict";var i=i||{},s=t("./vecmath.js");i.Rendable=function(t,e,r,i,a,n){this.gl=t,this.model=e,this.texture=r,this.position=i,this.rotation=a,this.lastTexture=r,this.shaderid=n||"defolt",this.size=1,this.checks=this.size+a+i.x>>1+i.y>>2+i.z>>3,this.mov_matrix=[this.size,0,0,0,0,this.size,0,0,0,0,this.size,0,this.position.x,this.position.y,this.position.z,1],this.mov_matrix=s.rotate(this.mov_matrix,this.rotation,[0,1,0]),this.inv_trans=s.inverse_transpose3x3from4(this.mov_matrix)},i.Rendable.prototype.constructor=i.Rendable,i.lastModel=[],i.Rendable.prototype.Draw=function(t){var e=this.gl;this.checks!=this.size+this.rotation+this.position.x+2.57*this.position.y+3.22*this.position.z&&(this.checks=this.size+this.rotation+this.position.x+2.57*this.position.y+3.22*this.position.z,this.mov_matrix=[this.size,0,0,0,0,this.size,0,0,0,0,this.size,0,this.position.x,this.position.y,this.position.z,1],0!=this.rotation&&(this.mov_matrix=s.rotatef(this.mov_matrix,this.rotation,[0,1,0])),t.inv_trans&&s.inverse_transpose3x3from4(this.mov_matrix,this.inv_trans)),e.uniformMatrix4fv(t.Mmatrix,!1,this.mov_matrix),t.inv_trans&&e.uniformMatrix3fv(t.inv_trans,!1,this.inv_trans),i.lastTexture==this.texture&&i.lastShader!=t||(e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,this.texture),i.lastTexture=this.texture),this.model.Draw(t)},i.Rendable.prototype.Draw1=function(t){var e=this.gl;this.checks!=.255*this.size.x+.689*this.size.y+.245*this.size.z+this.rotation+this.position.x+2.57*this.position.y+3.22*this.position.z&&(this.checks=.255*this.size.x+.689*this.size.y+.245*this.size.z+this.rotation+this.position.x+2.57*this.position.y+3.22*this.position.z,this.mov_matrix=[this.size.x,0,0,0,0,this.size.y,0,0,0,0,this.size.z,0,this.position.x,this.position.y,this.position.z,1],0!=this.rotation&&(this.mov_matrix=s.rotatef(this.mov_matrix,this.rotation,[0,1,0])),t.inv_trans&&s.inverse_transpose3x3from4(this.mov_matrix,this.inv_trans)),e.uniformMatrix4fv(t.Mmatrix,!1,this.mov_matrix),t.inv_trans&&e.uniformMatrix3fv(t.inv_trans,!1,this.inv_trans),i.lastTexture==this.texture&&i.lastShader!=t||(e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,this.texture),i.lastTexture=this.texture),this.model.Draw(t)},i.ARendable=function(t,e,r,i,a,n){this.gl=t,this.model=e,this.texture=r,this.numModel=e.length,this.numText=r.length,this.curModel=0,this.curText=0,this.shaderid=n||"defolt",this.position=i,this.rotation=a,this.size=1,this.checks=this.size+a+i.x>>1+i.y>>2+i.z>>3,this.mov_matrix=[this.size,0,0,0,0,this.size,0,0,0,0,this.size,0,this.position.x,this.position.y,this.position.z,1],this.mov_matrix=s.rotate(this.mov_matrix,this.rotation,[0,1,0]),this.inv_trans=s.inverse_transpose3x3from4(this.mov_matrix)},i.ARendable.prototype.constructor=i.ARendable,i.ARendable.prototype.Draw=function(t){var e=this.gl;this.checks!=this.size+this.rotation+this.position.x+2.57*this.position.y+3.22*this.position.z&&(this.checks=this.size+this.rotation+this.position.x+2.57*this.position.y+3.22*this.position.z,this.mov_matrix=[this.size,0,0,0,0,this.size,0,0,0,0,this.size,0,this.position.x,this.position.y,this.position.z,1],0!=this.rotation&&(this.mov_matrix=s.rotatef(this.mov_matrix,this.rotation,[0,1,0])),t.inv_trans&&s.inverse_transpose3x3from4(this.mov_matrix,this.inv_trans)),e.uniformMatrix4fv(t.Mmatrix,!1,this.mov_matrix),t.inv_trans>=0&&e.uniformMatrix3fv(t.inv_trans,!1,this.inv_trans),this.lastTexture=this.texture[this.curText%this.numText],i.lastTexture==this.lastTexture&&i.lastShader!=t||(e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,this.lastTexture),i.lastTexture=this.lastTexture),this.model[this.curModel%this.numModel].Draw(t)},e&&(e.exports=i)},{"./vecmath.js":8}],7:[function(t,e,r){"use strict";var i=i||{};i.Shader=function(t,e,r,i,s){this.gl=t,this.vertex=e,this.fragment=r,this.uniforms=i,this.atribs=s;var a=t.createProgram();t.attachShader(a,e),t.attachShader(a,r),t.linkProgram(a);var n=this;if(!t.getProgramParameter(a,t.LINK_STATUS))throw"Could not initialise shaders";i.forEach(function(e){n[e]=t.getUniformLocation(a,e)}),s.forEach(function(e){n[e]=t.getAttribLocation(a,e)}),t.useProgram(a),this.program=a},i.Shader.prototype.select=function(){this.gl.useProgram(this.program)},e&&(e.exports=i)},{}],8:[function(t,e,r){"use strict";var i={};i.isGLfloat="undefined"!=typeof Float32Array,i.pomararay=i.isGLfloat?new Float32Array(16):new Array(16),i.pomararay3=i.isGLfloat?new Float32Array(9):new Array(9),i.getInit3=function(){return i.isGLfloat?i.indentZerro3(new Float32Array(9)):[1,0,0,0,1,0,0,0,1]},i.getInit=function(){return i.isGLfloat?i.indentZerro(new Float32Array(16)):[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]},i.indentZerro=function(t){return t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},i.indentZerro3=function(t){return t[0]=1,t[4]=1,t[8]=1,t},i.indentCopy=i.getInit(),i.indent=function(t){for(var e=0;e<16;e++)t[e]=i.indentCopy[e]},i.perspective=function(t,e,r,s){var a=i.isGLfloat?new Float32Array(16):new Array(16),n=1/Math.tan(t/2);return a[0]=n/e,a[5]=n,a[10]=(s+r)/(r-s),a[14]=-1,a[11]=2*s*r/(r-s),a},i.orthogonal=function(t,e,r,s){var a=i.isGLfloat?new Float32Array(16):new Array(16);return a[0]=2/t/e,a[5]=2/t,a[10]=-2/(s-r),a[14]=-(r+s)/(s-r),a[15]=1,a},i.rotate=function(t,e,r,s){var a=r[0],n=r[1],o=r[2];s||(s=i.isGLfloat?new Float32Array(16):new Array(16));var h=1-Math.cos(e),u=Math.sin(e),l=Math.cos(e);return s[0]=a*a*h+l,s[4]=n*a*h-o*u,s[8]=o*a*h+n*u,s[1]=a*a*h+o*u,s[5]=n*n*h+l,s[9]=o*a*h-a*u,s[2]=a*o*h-n*u,s[6]=n*o*h+a*u,s[10]=o*o*h+l,s[15]=1,s=i.multiplay(s,t)},i.rotatef=function(t,e,r,s){var a=r[0],n=r[1],o=r[2];s||(s=i.pomararay);var h=i.pomararay3,u=1-Math.cos(e),l=Math.sin(e),c=Math.cos(e);return h[0]=a*a*u+c,h[1]=a*n*u+o*l,h[2]=a*o*u-n*l,h[3]=n*a*u-o*l,h[4]=n*n*u+c,h[5]=n*o*u+a*l,h[6]=o*a*u+n*l,h[7]=o*n*u-a*l,h[8]=o*o*u+c,s[0]=h[0]*t[0]+h[1]*t[4]+h[2]*t[8],s[1]=h[0]*t[1]+h[1]*t[5]+h[2]*t[9],s[2]=h[0]*t[2]+h[1]*t[6]+h[2]*t[10],s[3]=h[0]*t[3]+h[1]*t[7]+h[2]*t[11],s[4]=h[3]*t[0]+h[4]*t[4]+h[5]*t[8],s[5]=h[3]*t[1]+h[4]*t[5]+h[5]*t[9],s[6]=h[3]*t[2]+h[4]*t[6]+h[5]*t[10],s[7]=h[3]*t[3]+h[4]*t[7]+h[5]*t[11],s[8]=h[6]*t[0]+h[7]*t[4]+h[8]*t[8],s[9]=h[6]*t[1]+h[7]*t[5]+h[8]*t[9],s[10]=h[6]*t[2]+h[7]*t[6]+h[8]*t[10],s[11]=h[6]*t[3]+h[7]*t[7]+h[8]*t[11],t[0]=s[0],t[1]=s[1],t[2]=s[2],t[3]=s[3],t[4]=s[4],t[5]=s[5],t[6]=s[6],t[7]=s[7],t[8]=s[8],t[9]=s[9],t[10]=s[10],t[11]=s[11],t},i.translate=function(t,e){var r=e[0],s=e[1],a=e[2],n=i.getInit();return n[12]+=r,n[13]+=s,n[14]+=a,i.multiplay(n,t)},i.translatef=function(t,e){var r=e[0],i=e[1],s=e[2];return t[12]=r*t[0]+i*t[4]+s*t[8]+t[12],t[13]=r*t[1]+i*t[5]+s*t[9]+t[13],t[14]=r*t[2]+i*t[6]+s*t[10]+t[14],t[15]=r*t[3]+i*t[7]+s*t[11]+t[15],t},i.multiplay=function(t,e,r){return r||(r=i.isGLfloat?new Float32Array(16):new Array(16)),r[0]=t[0]*e[0]+t[1]*e[4]+t[2]*e[8]+t[3]*e[12],r[1]=t[0]*e[1]+t[1]*e[5]+t[2]*e[9]+t[3]*e[13],r[2]=t[0]*e[2]+t[1]*e[6]+t[2]*e[10]+t[3]*e[14],r[3]=t[0]*e[3]+t[1]*e[7]+t[2]*e[11]+t[3]*e[15],r[4]=t[4]*e[0]+t[5]*e[4]+t[6]*e[8]+t[7]*e[12],r[5]=t[4]*e[1]+t[5]*e[5]+t[6]*e[9]+t[7]*e[13],r[6]=t[4]*e[2]+t[5]*e[6]+t[6]*e[10]+t[7]*e[14],r[7]=t[4]*e[3]+t[5]*e[7]+t[6]*e[11]+t[7]*e[15],r[8]=t[8]*e[0]+t[9]*e[4]+t[10]*e[8]+t[11]*e[12],r[9]=t[8]*e[1]+t[9]*e[5]+t[10]*e[9]+t[11]*e[13],r[10]=t[8]*e[2]+t[9]*e[6]+t[10]*e[10]+t[11]*e[14],r[11]=t[8]*e[3]+t[9]*e[7]+t[10]*e[11]+t[11]*e[15],r[12]=t[12]*e[0]+t[13]*e[4]+t[14]*e[8]+t[15]*e[12],r[13]=t[12]*e[1]+t[13]*e[5]+t[14]*e[9]+t[15]*e[13],r[14]=t[12]*e[2]+t[13]*e[6]+t[14]*e[10]+t[15]*e[14],r[15]=t[12]*e[3]+t[13]*e[7]+t[14]*e[11]+t[15]*e[15],r},i.transpse=function(t){var e=i.isGLfloat?new Float32Array(16):new Array(16);e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15],t=e},i.transpse3=function(t){var e=i.isGLfloat?new Float32Array(16):new Array(16);e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],t=e},i.inverse_transpose3x3from4=function(t,e){var r=t[0]*(t[5]*t[11]-t[10]*t[6])-t[1]*(t[4]*t[11]-t[6]*t[9])+t[2]*(t[4]*t[10]-t[5]*t[9]);if(0==r)return this.getInit3();var s=1/r;return e||(e=i.isGLfloat?new Float32Array(9):new Array(9)),e[0]=(t[4]*t[8]-t[7]*t[5])*s,e[1]=-(t[1]*t[8]-t[2]*t[7])*s,e[2]=(t[1]*t[5]-t[2]*t[4])*s,e[3]=-(t[3]*t[8]-t[5]*t[6])*s,e[4]=(t[0]*t[8]-t[2]*t[6])*s,e[5]=-(t[0]*t[5]-t[3]*t[2])*s,e[6]=(t[3]*t[7]-t[6]*t[4])*s,e[7]=-(t[0]*t[7]-t[6]*t[1])*s,e[8]=(t[0]*t[4]-t[3]*t[1])*s,e},i.vNormalise=function(t){var e=0;for(var r in t)e+=t[r]*t[r];var i=Math.sqrt(e);for(var r in t)t[r]=t[r]/i;return t},i.vDotProduct=function(t,e){var r=0;for(var i in t)r+=t[i]*e[i];return r},i.v3CrossProduct=function(t,e){return{x:t.y*e.z-t.z*e.y,y:t.z*e.x-t.x*e.z,z:t.x*e.y-t.y*e.x}},i.minus3=function(t,e){return{x:t.x-e.x,y:t.y-e.y,z:t.z-e.z}},i.minus2=function(t,e){return{x:t.x-e.x,y:t.y,z:t.z-e.z}},i.plus3=function(t,e){return{x:t.x+e.x,y:t.y+e.y,z:t.z+e.z}},i.multiplay=function(t,e){return{x:t.x*e,y:t.y*e,z:t.z*e}},i.vDistance=function(t,e){var r={};for(var i in t)r+=(t[i]-e[i])*(t[i]-e[i]);return Math.sqrt(r)},i.triangleScope=function(t,e,r){var i={lx:t.x,ly:t.y,lz:t.z,bx:t.x,by:t.y,bz:t.z};return i.lx>e.x&&(i.lx=e.x),i.ly>e.y&&(i.ly=e.y),i.lz>e.z&&(i.lz=e.z),i.bx<e.x&&(i.bx=e.x),i.by<e.y&&(i.by=e.y),i.bz<e.z&&(i.bz=e.z),i.lx>r.x&&(i.lx=r.x),i.ly>r.y&&(i.ly=r.y),i.lz>r.z&&(i.lz=r.z),i.bx<r.x&&(i.bx=r.x),i.by<r.y&&(i.by=r.y),i.bz<r.z&&(i.bz=r.z),i},i.vertexInTriangleScope=function(t,e,r,s){var a=i.TriangleScope(e,r,s);return!(t.x<a.lx||t.y<a.ly||t.z<a.lz||t.x>a.bx||t.y>a.by||t.z>a.bz)},i.vertexInTriangle=function(t,e,r,s,a){if(t.x<a.lx||t.y<a.ly||t.z<a.lz||t.x>a.bx||t.y>a.by||t.z>a.bz)return!1;var n,o=i.minus3(t,e),h=i.minus3(t,r),u=i.minus3(t,s);i.V3Normalise(o),i.V3Normalise(h),i.V3Normalise(u),n=Math.acos(i.V3dotProduct(o,h))+Math.acos(i.V3dotProduct(h,u))+Math.acos(i.V3dotProduct(u,o));var l=Math.abs(n-2*Math.PI);return x_rot>l&&(x_rot=l),l<.05},i.CalculateNormal=function(t,e,r){var s=i.minus3(e,t),a=i.minus3(r,t),n={x:0,y:0,z:0};return n.x=s.y*a.z-s.z*a.y,n.y=s.z*a.x-s.x*a.z,n.z=s.x*a.y-s.y*a.x,i.V3Normalise(n),n},i.GenInvertTranspose=function(t,e){var r=t[0]*(t[5]*t[10]-t[9]*t[6])-t[1]*(t[4]*t[10]-t[6]*t[8])+t[2]*(t[4]*t[9]-t[5]*t[8]);Math.abs(r)<1e-4&&(r=r<0?-1e-4:1e-4);var i=1/r;return e[0]=(t[5]*t[10]-t[9]*t[6])*i,e[3]=-(t[1]*t[10]-t[2]*t[9])*i,e[6]=(t[1]*t[6]-t[2]*t[5])*i,e[1]=-(t[4]*t[10]-t[6]*t[8])*i,e[4]=(t[0]*t[10]-t[2]*t[8])*i,e[7]=-(t[0]*t[6]-t[4]*t[2])*i,e[2]=(t[4]*t[9]-t[8]*t[5])*i,e[5]=-(t[0]*t[9]-t[8]*t[1])*i,e[8]=(t[0]*t[5]-t[4]*t[1])*i,e},e&&(e.exports=i)},{}]},{},[4]);
